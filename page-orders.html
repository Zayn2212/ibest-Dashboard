<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="">
  <meta property="og:type" content="">
  <meta property="og:url" content="">
  <meta property="og:image" content="">
  <link rel="shortcut icon" type="image/x-icon" href="assets/imgs/theme/favicon.svg">
  <link href="assets/css/style.css?v=1.0.0" rel="stylesheet">
  <title>ibest - Orders</title>
</head>

<body>
  <div class="screen-overlay"></div>
  <aside class="navbar-aside" id="offcanvas_aside">
    <div class="aside-top"><a class="brand-wrap" href="page-dashboard.html"><img class="logo"
          src="assets/imgs/theme/favicon.svg" alt="Evara Dashboard"></a>
      <div>
        <button class="btn btn-icon btn-aside-minimize"><i class="text-muted material-icons md-menu_open"></i></button>
      </div>
    </div>
    <nav>
      <ul class="menu-aside">
        <li class="menu-item"><a class="menu-link" href="page-dashboard.html"><i
              class="icon material-icons md-home"></i><span class="text">Dashboard</span></a></li>
        <li class="menu-item"><a class="menu-link" href="page-products-list.html"><i
              class="icon material-icons md-shopping_bag"></i><span class="text">Products</span></a></li>
        <li class="menu-item active"><a class="menu-link" href="page-orders.html"><i
              class="icon material-icons md-shopping_cart"></i><span class="text">Orders</span></a></li>
        <li class="menu-item"><a class="menu-link" href="page-sellers-list.html"><i
              class="icon material-icons md-store"></i><span class="text">Wholesellers</span></a></li>
        <li class="menu-item"><a class="menu-link" href="page-account-register.html"><i
              class="icon material-icons md-person"></i><span class="text">Create Moderator</span></a></li>
        <li class="menu-item"><a class="menu-link" href="page-reviews.html"><i
              class="icon material-icons md-comment"></i><span class="text">Reviews</span></a></li>
      </ul>
      <hr>
      <ul class="menu-aside">
        <li class="menu-item"><a class="menu-link" href="page-error-404.html"><i
              class="icon material-icons md-settings"></i><span class="text">Settings</span></a></li>
      </ul>
    </nav>
  </aside>
  <main class="main-wrap">
    <header class="main-header navbar">
      <div class="col-search"></div>
      <div class="col-nav">
        <button class="btn btn-icon btn-mobile me-auto" data-trigger="#offcanvas_aside"><i
            class="material-icons md-apps"></i></button>
        <ul class="nav">
          <li class="nav-item"><a class="nav-link btn-icon" href="#"><i
                class="material-icons md-notifications animation-shake"></i><span class="badge rounded-pill"
                id="notification-badge">0</span></a></li>
          <li class="nav-item"><a class="nav-link btn-icon darkmode" href="#"><i
                class="material-icons md-nights_stay"></i></a></li>
          <li class="nav-item"><a class="requestfullscreen nav-link btn-icon" href="#"><i
                class="material-icons md-cast"></i></a></li>
          <li class="nav-item"><a class="dropdown-toggle" id="dropdownAccount" data-bs-toggle="dropdown" href="#"
              aria-expanded="false"><img class="img-xs rounded-circle" src="assets/imgs/people/avatar2.jpg"
                alt="User"></a>
            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownAccount">
              <a class="dropdown-item text-danger" onclick="adminOutUser()"><i
                  class="material-icons md-exit_to_app"></i>Logout</a>
            </div>
          </li>
        </ul>
      </div>
    </header>
    <section class="content-main">
      <div class="content-header">
        <div>
          <h2 class="content-title card-title">Order List</h2>
          <p>Add, edit or delete a order.</p>
        </div>
        <!-- <div>
          <input class="form-control bg-white" type="text" id="searchInput" placeholder="Search order ID" oninput="searchOrders()">
        </div>-->
      </div>
      <div class="card mb-4">
        <header class="card-header">
          <div class="row gx-3">
            <div class="col-lg-4 col-md-6 me-auto">
              <input class="form-control" type="text" id="searchInput" placeholder="Search by Name"
                oninput="searchOrders()">
            </div>
            <div class="col-lg-2 col-6 col-md-3" id="filter_status">
              <select class="form-select">
                <option selected="active">Show All</option>
                <option>Pending</option>
                <option>Received</option>
                <option>Canceled</option>
              </select>
            </div>
            <!--<div class="col-lg-2 col-6 col-md-3">
                <select class="form-select">
                  <option>Show 20</option>
                  <option>Show 30</option>
                  <option>Show 40</option>
                </select>
              </div>-->
          </div>
        </header>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>No</th>
                  <th scope="col">Name</th>
                  <th scope="col">#OrderID</th>
                  <th scope="col">Total</th>
                  <th scope="col">Status</th>
                  <th scope="col">Date</th>
                  <th class="text-end" scope="col"> Action</th>
                </tr>
              </thead>
              <tbody>
                <!--Order will show here dynamically-->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="pagination-area mt-30 mb-50 d-flex justify-content-center">
        <nav aria-label="Page navigation example">
          <ul class="pagination justify-content-start">
            <li class="page-item"><a class="page-link" href="#"><i class="material-icons md-chevron_left"></i></a></li>
            <!--Page number will dsiplay here-->
            <li class="page-item"><a class="page-link" href="#"><i class="material-icons md-chevron_right"></i></a></li>
          </ul>
        </nav>
      </div>
    </section>
    <footer class="main-footer font-xs">
      <div class="row pb-30 pt-15">
        <div class="col-sm-6">
          <script>document.write(new Date().getFullYear())</script> &copy;, ibest.
        </div>
        <div class="col-sm-6">
          <div class="text-sm-end">All rights reserved</div>
        </div>
      </div>
    </footer>

    <!-- Edit status Model -->
    <div class="modal fade" id="editStatusModal" tabindex="-1" aria-labelledby="editStatustModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title" id="editStatusModalLabel">Edit Status</h3>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="editProductForm">
              <div class="mb-4">
                <label class="form-label" for="order_status">Status</label>
                <select class="form-select" id="order_status">
                  <option value="progress">Pending</option>
                  <option value="delivered">Received</option>
                  <option value="cancel">Canceled</option>
                </select>
              </div>

              <!-- Add more input fields for other product details -->
            </form>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-light-model rounded" id="saveOrderChanges">Save changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title" id="orderDetailModalLabel">Order Detail</h3>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="orderDetailModalBody">
            <!-- Order details will be dynamically inserted here -->
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-light-model rounded" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirm Modal -->
    <div class="modal fade" id="deleteOrderModal" tabindex="-1" aria-labelledby="deleteOrderModalLabel"
      aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h3 class="modal-title" id="deleteOrderModalLabel">Delete Order</h3>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body d-flex justify-content-center">
            <h4 class="content-title card-title">Are you sure you want to delete order?</h4>
          </div>
          <div class="modal-footer d-flex justify-content-center">
            <button type="button" class="btn btn-primary rounded" id="confirmDelete">Yes</button>
            <button type="button" class="btn btn-light-model rounded" data-bs-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>
  </main>
  <script src="assets/js/vendors/jquery-3.6.0.min.js"></script>
  <script src="assets/js/vendors/bootstrap.bundle.min.js"></script>
  <script src="assets/js/vendors/select2.min.js"></script>
  <script src="assets/js/vendors/perfect-scrollbar.js"></script>
  <script src="assets/js/vendors/jquery.fullscreen.min.js"></script>
  <script src="assets/js/vendors/chart.js"></script>
  <script src="assets/js/main.js?v=1.0.0"></script>
  <script src="assets/js/custom-chart.js" type="text/javascript"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAKUrhFJiaHhFlqu0w3zKTyhIgXJNIIg68",
      authDomain: "ibest-ba2cf.firebaseapp.com",
      projectId: "ibest-ba2cf",
      storageBucket: "ibest-ba2cf.appspot.com",
      messagingSenderId: "946876798909",
      appId: "1:946876798909:web:b40bc879e556a26cafe4d4",
      measurementId: "G-QYR88B09WG"
    };
    firebase.initializeApp(firebaseConfig);

    var firestore = firebase.firestore();
    var auth = firebase.auth();
    var storage = firebase.storage();
    var storageRef = storage.ref();
    var docId = {};
    var orderId = {};
    var status = {};



    function setupPagination() {
      const rowsPerPage = 5;
      let currentPage = 1;

      const tableRows = document.querySelectorAll('.table tbody tr');

      // Function to calculate the total number of pages
      function calculateTotalPages() {
        return Math.ceil(tableRows.length / rowsPerPage);
      }

      // Function to update pagination HTML
      function updatePagination(totalPages) {
        const paginationList = document.querySelector('.pagination');
        paginationList.innerHTML = ''; // Clear existing pagination

        // Left pagination button
        const leftButton = createPaginationButton('md-chevron_left');
        leftButton.addEventListener('click', () => goToPreviousPage());
        paginationList.appendChild(leftButton);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
          const listItem = document.createElement('li');
          listItem.classList.add('page-item');
          if (i === currentPage) {
            listItem.classList.add('active');
          }
          const link = document.createElement('a');
          link.classList.add('page-link');
          link.href = '#';
          link.textContent = i;
          link.addEventListener('click', () => goToPage(i));
          listItem.appendChild(link);
          paginationList.appendChild(listItem);
        }

        // Right pagination button
        const rightButton = createPaginationButton('md-chevron_right');
        rightButton.addEventListener('click', () => goToNextPage());
        paginationList.appendChild(rightButton);
      }

      // Function to create pagination button
      function createPaginationButton(iconClass) {
        const button = document.createElement('li');
        button.classList.add('page-item');
        const link = document.createElement('a');
        link.classList.add('page-link');
        link.href = '#';
        link.innerHTML = `<i class="material-icons ${iconClass}"></i>`;
        button.appendChild(link);
        return button;
      }

      // Function to show rows for the given page
      function showRowsForPage(pageNumber) {
        const startIndex = (pageNumber - 1) * rowsPerPage;
        const endIndex = startIndex + rowsPerPage;

        tableRows.forEach((row, index) => {
          if (index >= startIndex && index < endIndex) {
            row.style.display = 'table-row';
          } else {
            row.style.display = 'none';
          }
        });
      }

      // Function to go to the previous page
      function goToPreviousPage() {
        if (currentPage > 1) {
          currentPage--;
          updatePagination(calculateTotalPages());
          showRowsForPage(currentPage);
        }
      }

      // Function to go to the next page
      function goToNextPage() {
        if (currentPage < calculateTotalPages()) {
          currentPage++;
          updatePagination(calculateTotalPages());
          showRowsForPage(currentPage);
        }
      }

      // Function to go to a specific page
      function goToPage(pageNumber) {
        currentPage = pageNumber;
        updatePagination(calculateTotalPages());
        showRowsForPage(currentPage);
      }

      // Initial setup
      const totalPages = calculateTotalPages();
      updatePagination(totalPages);
      showRowsForPage(currentPage);
    }



    async function populateFilters() {
      const searchInput = document.getElementById('searchInput').value.trim().toLowerCase();
      status = "Show All";
      fetchOrders(status, searchInput)
        .then(() => {
          setupPagination();
        })
        .catch((error) => {
          console.error('Error fetching and displaying orders:', error);
        });

      // Get the <select> element
      const selectElementStatus = document.querySelector('#filter_status');

      // Add event listener for change event
      selectElementStatus.addEventListener('change', function (event) {
        // Get the selected value
        const selectedStatus = event.target.value;
        const searchInput = document.getElementById('searchInput').value.trim().toLowerCase();
        status = selectedStatus;
        fetchOrders(selectedStatus, searchInput)
          .then(() => {
            setupPagination();
          })
          .catch((error) => {
            console.error('Error fetching and displaying products:', error);
          });
      });
    }

    function changeOrderNotification() {
      const ordersCollectionRef = firebase.firestore().collection('users');
      ordersCollectionRef.get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          const userData = doc.data();
          const updatedOrders = userData.orders.map((order) => {
            return { ...order, viewed: true };
          });

          // Update the orders data in Firestore
          doc.ref.update({ orders: updatedOrders })
            .then(() => {
              console.log("Orders updated successfully.");
            })
            .catch((error) => {
              console.error("Error updating orders:", error);
            });
        });
      }).catch((error) => {
        console.error("Error fetching order notification:", error);
      });
    }


    // Call function when the page loads
    populateFilters();
    changeOrderNotification();

    function searchOrders() {
      const searchInput = document.getElementById('searchInput').value.trim().toLowerCase();
      const status = document.querySelector('#filter_status select').value; // Get the selected status filter
      fetchOrders(status, searchInput);
    }



    function fetchOrders(status, searchQuery) {
      return new Promise((resolve, reject) => {
        const ordersCollectionRef = firebase.firestore().collection('users');
        let count = 1;

        if (status !== 'Show All') {
          var updatedStatus = getUpdatedStatus(status);
        } else {
          var updatedStatus = 'Show All';
        }


        ordersCollectionRef.get().then((querySnapshot) => {
          const tbody = document.querySelector('tbody');
          tbody.innerHTML = '';

          querySnapshot.forEach((doc) => {
            const userData = doc.data();
            userData.orders.forEach((order) => {

              if ((updatedStatus === 'Show All' || order.status === updatedStatus) &&
                (searchQuery === '' ||
                  userData.Name.toLowerCase().includes(searchQuery) ||
                  order.orderId.toLowerCase().includes(searchQuery))) {
                const tableRow = `
                      <tr>
                        <td>${count}</td>
                        <td><b>${userData.Name}</b></td>
                        <td>${order.orderId}</td>
                        <td>R ${order.totalPrice.toFixed(2)}</td>
                        <td><span class="badge rounded-pill ${getStatusBadgeClass(order.status)}">${getStatus(order.status)}</span></td>
                        <td>${formatDate(order.orderDate)}</td>
                        <td class="text-end">
                          <a class="btn btn-md rounded font-sm" onclick="orderDetail('${doc.id}','${order.orderId}')">Detail</a>
                          <div class="dropdown">
                            <a class="btn btn-light rounded btn-sm font-sm" href="#" data-bs-toggle="dropdown">
                              <i class="material-icons md-more_horiz"></i>
                            </a>
                            <div class="dropdown-menu">
                              <a class="dropdown-item" onclick="orderDetail('${doc.id}','${order.orderId}')">View detail</a>
                              <a class="dropdown-item" onclick="editStatus('${doc.id}','${order.orderId}')">Edit Status</a>
                              <a class="dropdown-item text-danger" onclick="confirmDeletion('${doc.id}','${order.orderId}')">Delete</a>
                            </div>
                          </div>
                        </td>
                      </tr>
                `;
                document.querySelector('.table tbody').insertAdjacentHTML('beforeend', tableRow);
                count++;
              }
            });
          });

          resolve(); // Resolve the promise without any specific data
        }).catch((error) => {
          reject(error); // Reject the promise if there's an error
        });
      });
    }


    function orderDetail(docID, orderID) {
      const userCollectionRef = firebase.firestore().collection('users').doc(docID);
      userCollectionRef.get()
        .then((doc) => {
          if (doc.exists) {
            // Data exists, you can access it using doc.data()
            const data = doc.data();
            const order = filterOrderByID(data.orders, orderID);
            if (order) {
              const productRef = firestore.collection('products').doc(order.category).collection(order.subCategory).doc(orderID);
              productRef.get()
                .then((doc) => {
                  if (doc.exists) {
                    const product = doc.data();
                    // Access the modal body element
                    const modalBody = document.getElementById('orderDetailModalBody');
                    let discountedPrice = product.price * (product.discount / 100);
                    let newPrice = product.price - discountedPrice;
                    // Generate HTML content for the order details
                    const orderDetailsHTML = `
                      <p><strong>Name:</strong> ${data.Name}</p>
                      <p><strong>Email:</strong> ${data.Email}</p>
                      <p><strong>Product:</strong> ${product.product}</p>
                      <p><strong>Product ID:</strong> ${doc.id}</p>
                      <p><strong>Original Price:</strong> R ${product.price}</p>
                      <p><strong>Discount:</strong> ${product.discount} %</p>
                      <p><strong>Discount Price:</strong> R ${newPrice}</p>
                      <p><strong>Quantity:</strong> ${order.orderQuantity}</p>
                      <p><strong>Total Price:</strong> R ${order.totalPrice}</p>
                      <p><strong>Order Date:</strong> ${order.orderDate}</p>
                      <!-- Add more order details as needed -->
                    `;

                    // Set the HTML content of the modal body
                    modalBody.innerHTML = orderDetailsHTML;

                    // Show the modal
                    const modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
                    modal.show();
                  } else {
                    console.log('No such document!');
                  }
                })
                .catch((error) => {
                  console.log('Error getting document:', error);
                });
            } else {
              console.log("Order not found");
            }

          } else {
            console.log('No such document!');
          }
        })
        .catch((error) => {
          console.log('Error getting document:', error);
        });
    }

    function editStatus(docID, orderID) {
      docId = docID;
      orderId = orderID;

      const userCollectionRef = firebase.firestore().collection('users').doc(docID);

      userCollectionRef.get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();
          const order = filterOrderByID(data.orders, orderID);
          if (order) {
            const selectElement = document.getElementById('order_status');
            const option1 = selectElement.options[0];//pending
            const option2 = selectElement.options[1];//received
            const option3 = selectElement.options[2];//canceled
            console.log("Status:", order.status);
            if (order.status === 'progess') {
              option1.selected = true;
            } else if (order.status === 'delivered') {
              option2.selected = true;
            } else if (order.status === 'cancel') {
              option3.selected = true;
            }
          } else {
            console.log("Order not found");
          }
        } else {
          console.log('No such document!');
        }
      }).catch((error) => {
        console.log('Error getting document:', error);
      });

      // Show the modal
      var myModal = new bootstrap.Modal(document.getElementById('editStatusModal'));
      myModal.show();
    }

    // Add event listener to the Save Changes button
    document.getElementById('saveOrderChanges').addEventListener('click', function () {
      // Close the modal
      $('#editStatusModal').modal('hide');

      const userCollectionRef = firebase.firestore().collection('users').doc(docId);
      userCollectionRef.get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();
          const orderIndex = findOrderIndexByID(data.orders, orderId);

          if (orderIndex !== -1) {
            const matchedOrder = data.orders[orderIndex];
            matchedOrder.status = document.getElementById('order_status').value; // Update status to selected option
            console.log("UpdatedSatus:", matchedOrder.status);
            // Update the orders array in the Firestore document
            userCollectionRef.update({ orders: data.orders }).then(() => {
              console.log('Order status updated successfully!');
              alert('Order status updated successfully!');
              window.location.href = "page-orders.html";
            }).catch((error) => {
              console.log('Error updating order status:', error);
            });
          } else {
            console.log("Order not found");
            alert('Order not found!');
          }
        } else {
          console.log('No such document!');
          alert('Order not found!');
        }
      }).catch((error) => {
        console.log('Error getting document:', error);
        alert('Order not found!');
      });
    });

    function confirmDeletion(docId, orderId) {
      // Show the modal
      var myModal = new bootstrap.Modal(document.getElementById('deleteOrderModal'));
      myModal.show();

      // Get references to the modal and buttons
      const deleteModal = document.getElementById('deleteOrderModal');
      const confirmDeleteBtn = document.getElementById('confirmDelete');

      // Add event listener to the "Yes" button
      confirmDeleteBtn.addEventListener('click', function () {
        deleteOrder(docId, orderId);

        // Close the modal
        const deleteOrderModal = bootstrap.Modal.getInstance(deleteModal);
        deleteOrderModal.hide();
      });
    }

    function deleteOrder(docID, orderID) {
      const userCollectionRef = firebase.firestore().collection('users').doc(docID);

      userCollectionRef.get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();
          const orderIndex = findOrderIndexByID(data.orders, orderID);

          if (orderIndex !== -1) {
            //Remove the order from the orders array
            data.orders.splice(orderIndex, 1);

            // Update the orders array in the Firestore document
            userCollectionRef.update({ orders: data.orders }).then(() => {
              console.log('Order deleted successfully!');
              window.location.href = "page-orders.html";
            }).catch((error) => {
              console.log('Error deleting order:', error);
            });
          } else {
            console.log("Order not found");
          }
        } else {
          console.log('No such document!');
        }
      }).catch((error) => {
        console.log('Error getting document:', error);
      });
    }

    // Function to find the index of an order in the orders array by its ID
    function findOrderIndexByID(orders, orderID) {
      for (let i = 0; i < orders.length; i++) {
        if (orders[i].orderId === orderID) {
          return i; // Return the index if found
        }
      }
      return -1; // Return -1 if not found
    }


    function filterOrderByID(orderArray, orderId) {
      for (const order of orderArray) {
        if (order.orderId === orderId) {
          return order;
        }
      }
      // If no order is found with the given ID, return null or handle the case as needed
      return null;
    }

    // Function to format date in "DD.MM.YYYY" format
    function formatDate(date) {
      const d = new Date(date);
      const day = d.getDate().toString().padStart(2, '0');
      const month = (d.getMonth() + 1).toString().padStart(2, '0');
      const year = d.getFullYear();
      return `${day}.${month}.${year}`;
    }

    // Function to get the badge class based on order status
    function getStatusBadgeClass(status) {
      switch (status) {
        case 'progress':
          return 'alert-warning';
        case 'cancel':
          return 'alert-danger';
        case 'delivered':
          return 'alert-success';
        default:
          return '';
      }
    }

    // Function to get the status based on firebase data
    function getStatus(status) {
      switch (status) {
        case 'progress':
          return 'Pending';
        case 'cancel':
          return 'Canceled';
        case 'delivered':
          return 'Received';
        default:
          return '';
      }
    }

    // Function to get the status based on filter
    function getUpdatedStatus(status) {
      switch (status) {
        case 'Pending':
          return 'progress';
        case 'Canceled':
          return 'cancel';
        case 'Received':
          return 'delivered';
        default:
          return '';
      }
    }

    var count = 0;

    function fetchOrders() {
      const ordersCollectionRef = firebase.firestore().collection('users');
      ordersCollectionRef.get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          const userData = doc.data();
          userData.orders.forEach((order) => {
            if (order.viewed === false) {
              count++;
            }
          });
        });
        var badge = document.getElementById("notification-badge");
        badge.textContent = count;
      }).catch((error) => {
        console.log("Error fetching order notification.");
      });
    }

    fetchOrders();

    // Function to sign out the admin
    function adminOutUser() {
      firebase.auth().signOut().then(function () {
        console.log('admin signed out successfully');
        alert('Admin signed out successfully!');
        window.location.href = 'index.html';
      }).catch(function (error) {
        console.error('Error signing out:', error);
      });
    }


  </script>
</body>


</html>
